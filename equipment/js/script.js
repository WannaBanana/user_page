$(document).ready(function(){$(".tabs").tabs(),$(".modal").modal(),$(".collapsible").collapsible(),M.AutoInit();var e="",t=0,n="";window.onhashchange=function(){var t,n,o=location.hash.replace("#","");switch(o){case"m":case"h":case"t":case"e":t=o,$("#calendar").fullCalendar("removeEventSources"),e={m:"管理學院",h:"人文學院",t:"科技學院",e:"教育學院"}[t],$("#header-text").html(`${e[0]}院`),n=e[0],$.ajax({url:`https://xn--pss23c41retm.tw/api/item/reservation/${e}`,type:"GET",error:function(e){alert("Ajax request 發生錯誤")},success:function(e){let t='<option value="" disabled selected>Choose your option</option>';for(const o in e)e.hasOwnProperty(o)&&(t+=`<option value="${o}">${n} ${o}</option>`);$("#room-selection").html(t)}})}location.hash=""},$("#room-selection").change(function(){isNaN(this.value)||""==this.value?$("#header-text").html("物品借閱"):($("#calendar").fullCalendar("removeEventSources"),console.log(this.value),t=this.value,$("#header-text").html(`${e[0]}院-${t}`),$.ajax({url:`https://xn--pss23c41retm.tw/api/item/${e}/${t}`,type:"GET",error:function(e){alert("Ajax request 發生錯誤")},success:function(e){let t='<option value="" disabled selected>Choose your option</option>';for(const n in e)e.hasOwnProperty(n)&&(t+=`<option value="${n}">${e[n].itemName}</option>`);$("#item-selection").html(t)}}))}),$("#item-selection").change(function(){""!=this.value?($("#calendar").fullCalendar("removeEventSources"),console.log(this.value),n=this.value,$.ajax({url:`https://xn--pss23c41retm.tw/api/item/reservation/${e}/${t}/${n}`,type:"GET",error:function(e){alert("Ajax request 發生錯誤")},success:function(e){console.log(e);var t=[];for(const n in e)if(e.hasOwnProperty(n))for(const o in e[n])e[n].hasOwnProperty(o)&&t.push(e[n][o]);console.log(t),$("#calendar").fullCalendar("addEventSource",t)}}),$("#header-text").html(`${n}`)):$("#header-text").html("物品借閱")}),$("#form-btn").click(function(o){o.preventDefault();let a="";0==t||""==e||""==n?(a='<h4 class="center-align" style="font-family:\'微軟正黑體\';">請選擇院別/教室!</h4>',$(".modal-footer").html('\n            <a href="#!" class="modal-close waves-effect waves-green btn-flat">Cancel</a>')):(a=`\n            <div style="padding-bottom:10px">\n                <span style="font-size:26px;font-family:'微軟正黑體';">借閱資訊</span>\n            </div>\n            <div class="chip">\n                ${e[0]}${t} - ${n}\n            </div>\n            <input type="text" id="start-date" class="datepicker" placeholder="Start-Date">\n            <input type="text" id="start-time" class="timepicker" placeholder="Start-Time">\n            <input type="text" id="end-time" class="timepicker" placeholder="End-Time">\n            <div class="input-field">\n                <input type="text" id="studentID" name="studentID">\n                <label for="studentID">Student ID</label>\n            </div>\n            <div class="input-field">\n                <input type="text" id="title" name="title">\n                <label for="title">Describe</label>\n            </div>\n            `,$(".modal-footer").html('\n            <div class="modalbtn">\n            <a href="#!" class="modal-close waves-effect btn-flat">Cancel</a>\n            <button id="subBtn" class="btn waves-effect">\n            Send</button>'));$("#reserve-form").html(a),M.Datepicker.init(document.querySelectorAll(".datepicker"),{container:".wrapper",autoClose:!0,format:"yyyy-mm-dd",showClearBtn:!0}),M.Timepicker.init(document.querySelectorAll(".timepicker"),{container:".wrapper",autoClose:!0,twelveHour:!1}),M.FormSelect.init(document.querySelectorAll("select")),M.Modal.getInstance(document.getElementById("modal1")).open()}),$(document).on("click","#subBtn",function(){var o=$("#start-date").val(),a=$("#start-time").val(),l=$("#end-time").val(),r=$("#studentID").val(),c=$("#title").val(),i={};if(i.itemID=n,console.log(n,o,a,l,r,c),!/(\d{4})-(\d{2})-(\d{2})/.test(o)||""==o)return void alert("起始日期格式錯誤");i.start=o,i.end=o;if(!/^([0-9]|0[0-9]|1[0-9]|2[0-3]):[0-5][0-9]$/.test(a))return void alert("開始時間格式錯誤");if(!/^([0-9]|0[0-9]|1[0-9]|2[0-3]):[0-5][0-9]$/.test(l))return void alert("結束時間格式錯誤");if(a>l)return void alert("結束時間小於開始時間");i.start+=`T${a}:00`,i.end+=`T${l}:00`;if(""==c)return void alert("請輸入描述");i.title=c;if(""==r)return void alert("請輸入學號");i.studentID=r;if(confirm("確定要借閱嗎?")){console.log(i),i.repeat="none",i.repeat_end="none",i.type="inside",i.conflict=!1,$.ajax({url:`https://xn--pss23c41retm.tw/api/item/reservation/${e}/${t}`,type:"POST",data:i,error:function(e){alert("Ajax request 發生錯誤"),console.log(e)},success:function(e){console.log(e),$("#calendar").fullCalendar("addEventSource",[i])}});var s=M.Modal.getInstance(document.getElementById("modal1"));s.close()}}),$(document).change(function(){var e=$("#myForm").serializeArray();console.log(e)}),$(".checkAll1").click(function(){$(".checkAll1").prop("checked")?$("input[name='room-checkbox[]']").prop("checked",!0):$("input[name='room-checkbox[]']").prop("checked",!1)}),$(".checkAll2").click(function(){$(".checkAll2").prop("checked")?$("input[name='item-checkbox[]']").prop("checked",!0):$("input[name='item-checkbox[]']").prop("checked",!1)})});