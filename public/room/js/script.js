$(document).ready(function(){$(".tabs").tabs(),$(".modal").modal(),$(".collapsible").collapsible(),M.AutoInit();var e="",t=0;window.onhashchange=function(){var t,n,a=location.hash.replace("#","");switch(a){case"m":case"h":case"t":case"e":t=a,$("#calendar").fullCalendar("removeEventSources"),e={m:"管理學院",h:"人文學院",t:"科技學院",e:"教育學院"}[t],$("#header-text").html(`${e[0]}院`),n=e[0],$.ajax({url:`https://xn--pss23c41retm.tw/api/reservation/${e}`,type:"GET",error:function(e){alert("Ajax request 發生錯誤")},success:function(e){let t='<option value="" disabled selected>Choose your option</option>';for(const a in e)e.hasOwnProperty(a)&&(t+=`<option value="${a}">${n} ${a}</option>`);$("#class-room").html(t)}})}location.hash=""},$("#class-room").change(function(){isNaN(this.value)||""==this.value?$("#header-text").html("教室預約"):($("#calendar").fullCalendar("removeEventSources"),console.log(this.value),t=this.value,$.ajax({url:`https://xn--pss23c41retm.tw/api/reservation/${e}/${t}`,type:"GET",error:function(e){alert("Ajax request 發生錯誤")},success:function(e){console.log(e);var t=[];for(const n in e)if(e.hasOwnProperty(n))for(const a in e[n])e[n].hasOwnProperty(a)&&("未核准"==e[n][a].state&&(e[n][a].name==getCookie("key")?e[n][a].color="orange":e[n][a].color="red"),t.push(e[n][a]));console.log(t),$("#calendar").fullCalendar("addEventSource",t)}}),$("#header-text").html(`${e[0]}院-${t}`))}),$("#form-btn").click(function(n){n.preventDefault();let a="";0==t||""==e?(a='<h4 class="center-align" style="font-family:\'微軟正黑體\';">請選擇院別/教室!</h4>',$(".modal-footer").html('\n            <a href="#!" class="modal-close waves-effect waves-green btn-flat">Cancel</a>')):(a=`\n            <div style="padding-bottom:10px">\n                <span style="font-size:26px;font-family:'微軟正黑體';">預約資訊</span>\n            </div>\n            <div class="chip">\n                ${e[0]}${t}\n            </div>\n            <input type="text" id="start-date" class="datepicker" placeholder="Start-Date">\n            <input type="text" id="start-time" class="timepicker" placeholder="Start-Time">\n            <input type="text" id="end-time" class="timepicker" placeholder="End-Time">\n            <div class="input-field">\n                <input type="text" id="userName">\n                <label for="userName">Name</label>\n            </div>\n            <div class="input-field">\n                <input type="text" id="des">\n                <label for="des">Describe</label>\n            </div>\n            <div class="input-field">\n                <input type="text" id="userPhone">\n                <label for="userPhone">Phone</label>\n            </div>\n            `,$(".modal-footer").html('\n            <div class="modalbtn">\n            <a href="#!" class="modal-close waves-effect btn-flat">Cancel</a>\n            <button id="subBtn" class="btn waves-effect">\n            Send</button>'));$("#reserve-form").html(a),M.Datepicker.init(document.querySelectorAll(".datepicker"),{container:".wrapper",autoClose:!0,format:"yyyy-mm-dd",showClearBtn:!0}),M.Timepicker.init(document.querySelectorAll(".timepicker"),{container:".wrapper",autoClose:!0,twelveHour:!1}),M.FormSelect.init(document.querySelectorAll("select")),M.Modal.getInstance(document.getElementById("modal1")).open()}),$(document).on("click","#subBtn",function(){var n=$("#start-date").val(),a=$("#des").val(),o=$("#start-time").val(),l=$("#end-time").val(),r=$("#userName").val(),c=$("#userPhone").val(),i={};if(console.log(n,o,l,r,c),!/(\d{4})-(\d{2})-(\d{2})/.test(n)||""==n)return void alert("起始日期格式錯誤");i.start=n,i.end=n;if(!/^([0-9]|0[0-9]|1[0-9]|2[0-3]):[0-5][0-9]$/.test(o))return void alert("開始時間格式錯誤");if(!/^([0-9]|0[0-9]|1[0-9]|2[0-3]):[0-5][0-9]$/.test(l))return void alert("結束時間格式錯誤");if(o>l)return void alert("結束時間小於開始時間");i.start+=`T${o}:00`,i.end+=`T${l}:00`;if(""==r)return void alert("請輸入姓名");i.name=r;if(""==a)return void alert("請輸入描述");i.title=a;if(""==c||isNaN(c))return void alert("請輸入連絡電話");i.phone=c;if(confirm("確定要預約嗎?")){console.log(i),i.repeat="none",i.repeat_end="none",i.type="inside",i.conflict=!1,$.ajax({url:`https://xn--pss23c41retm.tw/api/reservation/${e}/${t}`,type:"POST",data:i,error:function(e){alert("Ajax request 發生錯誤"),console.log(e)},success:function(e){console.log(e),$("#calendar").fullCalendar("addEventSource",[i])}});var s=M.Modal.getInstance(document.getElementById("modal1"));s.close()}}),$(document).change(function(){var e=$("#myForm").serializeArray();console.log(e)}),$(".checkAll1").click(function(){$(".checkAll1").prop("checked")?$("input[name='room-checkbox[]']").prop("checked",!0):$("input[name='room-checkbox[]']").prop("checked",!1)}),$(".checkAll2").click(function(){$(".checkAll2").prop("checked")?$("input[name='item-checkbox[]']").prop("checked",!0):$("input[name='item-checkbox[]']").prop("checked",!1)})});